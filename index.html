<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Беспутный — Чтение</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>Беспутный</h1>
</header>

<section id="chapters-container">
  <p>Загрузка глав...</p>
</section>

<section id="auth-section">
  <h2>Вход</h2>
  <input type="email" id="login-email" placeholder="Email">
  <input type="password" id="login-password" placeholder="Пароль">
  <button id="login-btn">Войти</button>
</section>

<section id="content-section" style="display:none;">
  <p>Вы вошли!</p>
  <button id="logout-btn">Выйти</button>
</section>

<script type="module" src="supabase-config.js"></script>
<script type="module" src="script.js"></script>
<script type="module">
  import { supabase } from './supabase-config.js'

  // Загрузка глав
  async function loadChapters() {
    const { data, error } = await supabase.from('chapters').select('*').order('id')

    const container = document.getElementById('chapters-container')
    if (error) {
      container.innerHTML = `<p>Ошибка загрузки глав: ${error.message}</p>`
      return
    }

    container.innerHTML = ''
    if (data && data.length > 0) {
      data.forEach(ch => {
        const div = document.createElement('div')
        div.className = 'chapter'
        div.innerHTML = `<h3>${ch.title}</h3><p>${ch.content}</p>`
        container.appendChild(div)
      })
    } else {
      container.innerHTML = '<p>Глав пока нет</p>'
    }
  }

  // Привязка кнопок входа/выхода
  async function loginUser() {
    const email = document.getElementById('login-email').value
    const password = document.getElementById('login-password').value

    const { data, error } = await supabase.auth.signInWithPassword({ email, password })
    if (error) {
      alert("Ошибка входа: " + error.message)
    } else {
      alert("Вход выполнен!")
      document.getElementById('auth-section').style.display = "none"
      document.getElementById('content-section').style.display = "block"
      loadChapters()
    }
  }

  async function logoutUser() {
    const { error } = await supabase.auth.signOut()
    if (error) alert("Ошибка выхода: " + error.message)
    else {
      document.getElementById('auth-section').style.display = "block"
      document.getElementById('content-section').style.display = "none"
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('login-btn').addEventListener('click', loginUser)
    document.getElementById('logout-btn').addEventListener('click', logoutUser)
    loadChapters()
  })
</script>

</body>
</html>
